{% extends "base.html" %}
{% load static %}
{% block content %}
<link type="text/css" rel="stylesheet" href="{% static 'css/main.css' %}">
<section class="text-xs">
  <div class="main-content container mx-auto py-4">
    <div class="header-body">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5">
        <div class="col-span-3 lg:col-span-1">
          <div class="card card-stats shadow-lg rounded-lg p-4" id="cardbody">
            <div class="card-body">
              <div class="flex justify-between">
                <div class="flex flex-col mr-4">
                  <h5 class="card-title text-sm font-semibold uppercase mb-2" id="cardtext">Students</h5>
                  <span class="h2 font-bold" id="summarytotals">{{enrolled_students_count}}</span>
                </div>
                <div id="cards"
                  class="icon icon-shape text-white rounded-full flex items-center justify-center w-12 h-12">
                  <i class='bx bxs-analyse text-lg'></i>
                </div>
              </div>
              <p class="mt-3 mb-0 text-sm flex justify-between" id="cardtext">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" id="cards_icon" viewBox="0 0 448 512">
                  <path d="M219.3 .5c3.1-.6 6.3-.6 9.4 0l200 40C439.9 42.7 448 52.6 448 64s-8.1 21.3-19.3 23.5L352 102.9l0 57.1c0 70.7-57.3 128-128 128s-128-57.3-128-128l0-57.1L48 93.3l0 65.1 15.7 78.4c.9 4.7-.3 9.6-3.3 13.3s-7.6 5.9-12.4 5.9l-32 0c-4.8 0-9.3-2.1-12.4-5.9s-4.3-8.6-3.3-13.3L16 158.4l0-71.8C6.5 83.3 0 74.3 0 64C0 52.6 8.1 42.7 19.3 40.5l200-40zM111.9 327.7c10.5-3.4 21.8 .4 29.4 8.5l71 75.5c6.3 6.7 17 6.7 23.3 0l71-75.5c7.6-8.1 18.9-11.9 29.4-8.5C401 348.6 448 409.4 448 481.3c0 17-13.8 30.7-30.7 30.7L30.7 512C13.8 512 0 498.2 0 481.3c0-71.9 47-132.7 111.9-153.6z"/></svg>
                <span class="text-nowrap">Enrolled Students</span>
              </p>
            </div>
          </div>
        </div>
        <div class="col-span-3 lg:col-span-1">
          <div class="card card-stats shadow-lg rounded-lg p-4" id="cardbody">
            <div class="card-body">
              <div class="flex justify-between">
                <div class="flex flex-col mr-4">
                  <h5 class="card-title text-sm font-semibold uppercase mb-2" id="cardtext">Questionnaires</h5>
                  <span class="h2 font-bold" id="summarytotals">{{total}}</span>
                </div>
                <div id="cards"
                  class="icon icon-shape text-white rounded-full flex items-center justify-center w-12 h-12">
                  <i class='bx bx-receipt text-lg'></i>
                </div>
              </div>
              <p class="mt-3 mb-0 text-sm flex justify-between" id="cardtext">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" id="cards_icon" viewBox="0 0 576 512">
                  <path d="M249.6 471.5c10.8 3.8 22.4-4.1 22.4-15.5l0-377.4c0-4.2-1.6-8.4-5-11C247.4 52 202.4 32 144 32C93.5 32 46.3 45.3 18.1 56.1C6.8 60.5 0 71.7 0 83.8L0 454.1c0 11.9 12.8 20.2 24.1 16.5C55.6 460.1 105.5 448 144 448c33.9 0 79 14 105.6 23.5zm76.8 0C353 462 398.1 448 432 448c38.5 0 88.4 12.1 119.9 22.6c11.3 3.8 24.1-4.6 24.1-16.5l0-370.3c0-12.1-6.8-23.3-18.1-27.6C529.7 45.3 482.5 32 432 32c-58.4 0-103.4 20-123 35.6c-3.3 2.6-5 6.8-5 11L304 456c0 11.4 11.7 19.3 22.4 15.5z"/></svg>
                <span class="text-nowrap">Total Questionnaires</span>
              </p>
            </div>
          </div>
        </div>
        <div class="col-span-3 lg:col-span-1">
          <div class="card card-stats shadow-lg rounded-lg p-4" id="cardbody">
            <div class="card-body">
              <div class="flex justify-between">
                <div class="flex flex-col mr-4">
                  <h5 class="card-title text-sm font-semibold uppercase mb-2" id="cardtext">Restricted</h5>
                  <span class="h2 font-bold" id="summarytotals">{{restricted_counts}}</span>
                </div>
                <div id="cards"
                  class="icon icon-shape text-white rounded-full flex items-center justify-center w-12 h-12">
                  <i class='bx bxs-edit-alt text-lg'></i>
                </div>
              </div>
              <p class="mt-3 mb-0 text-sm flex justify-between" id="cardtext">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" id="cards_icon" viewBox="0 0 512 512">
                  <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zm0-384c13.3 0 24 10.7 24 24l0 112c0 13.3-10.7 24-24 24s-24-10.7-24-24l0-112c0-13.3 10.7-24 24-24zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"/></svg>
                <span class="text-nowrap">Total Restricted</span>
              </p>
            </div>
          </div>
        </div>
        <div class="col-span-3 lg:col-span-1">
          <div class="card card-stats shadow-lg rounded-lg p-4" id="cardbody">
            <div class="card-body">
              <div class="flex justify-between">
                <div class="flex flex-col mr-4">
                  <h5 class="card-title text-sm font-semibold uppercase mb-2" id="cardtext">Passing rate</h5>
                  <span class="h2 font-bold" id="summarytotals">65.2%</span>
                </div>
                <div id="cards"
                  class="icon icon-shape text-white rounded-full flex items-center justify-center w-12 h-12">
                  <i class='bx bxs-objects-vertical-bottom text-lg'></i>
                </div>
              </div>
              <p class="mt-3 mb-0 text-sm flex justify-between" id="cardtext">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" id="cards_icon" viewBox="0 0 384 512">
                  <path d="M374.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-320 320c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l320-320zM128 128A64 64 0 1 0 0 128a64 64 0 1 0 128 0zM384 384a64 64 0 1 0 -128 0 64 64 0 1 0 128 0z"/></svg>
                <span class="text-nowrap">General Average</span>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<section>
  <div>
    <div class="flex justify-between gap-6 h-full">
      <div class="shadow-lg w-1/3 rounded-lg" id="bar_chart_body" style="height: 60vh; background-color: #fff; padding: 20px; border-radius: 10px;">
        <canvas id="chartDoughnut"></canvas>
      </div>
      <div class="w-2/3 flex flex-col justify-center rounded-xl shadow-lg h-full" id="bar_chart_body" style="height: 60vh; background-color: #fff; padding: 20px; border-radius: 10px;">
        <div class="rounded-b- h-full" id="bar-chart"></div>
      </div>
    </div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>

  // Doughnut Chart Configuration
  const dataDoughnut = {
    labels: ["Remembering", "Creating", "Applying", "Evaluating", "Understanding", "Analyzing"],
    datasets: [
      {
        label: "Restricted Counts",
        data: [{{restricted_remembering}}, {{restricted_creating}}, {{restricted_applying}}, {{restricted_evaluating}}, {{restricted_understanding}}, {{restricted_analyzing}}],
        backgroundColor: [
          "rgb(54, 162, 235)",
          "rgb(75, 192, 192)",
          "rgb(255, 205, 86)",
          "rgb(255, 159, 64)",
          "rgb(153, 102, 255)",
          "rgb(255, 99, 132)",
        ],
        hoverOffset: 4,
      },
    ],
  };
  
  const configDoughnut = {
    type: "doughnut",
    data: dataDoughnut,
    options: {},
  };
  
  var chartBar = new Chart(
    document.getElementById("chartDoughnut"),
    configDoughnut
  );
  
  // Bar Chart Configuration
  document.addEventListener('DOMContentLoaded', function () {
    const subjectCodes = {{ subject_codes|safe }};
    const subjectPercentages = {{ subject_percentages|safe }}.map(p => parseFloat(p).toFixed(1));
  
    const percentages = {
      remembering: parseFloat({{ remembering_percentage|floatformat:1 }}),
      creating: parseFloat({{ creating_percentage|floatformat:1 }}),
      understanding: parseFloat({{ understanding_percentage|floatformat:1 }}),
      applying: parseFloat({{ applying_percentage|floatformat:1 }}),
      analyzing: parseFloat({{ analyzing_percentage|floatformat:1 }}),
      evaluating: parseFloat({{ evaluating_percentage|floatformat:1 }}),
    };
  
    const chartConfig = {
      series: [
        {
          name: "Passing rate",
          data: [
            ...subjectPercentages,
            percentages.remembering,
            percentages.creating,
            percentages.understanding,
            percentages.applying,
            percentages.analyzing,
            percentages.evaluating,
          ],
        },
      ],
      chart: {
        type: "bar",
        height: 400,
        toolbar: {
          show: false,
        },
      },
      title: {
        show: "",
      },
      dataLabels: {
        enabled: false,
      },
      colors: ["#534a88"],
      plotOptions: {
        bar: {
          columnWidth: "40%",
          borderRadius: 2,
        },
      },
      xaxis: {
        axisTicks: {
          show: false,
        },
        axisBorder: {
          show: false,
        },
        labels: {
          style: {
            colors: "#243642",
            fontSize: "12px",
            fontFamily: "inherit",
            fontWeight: 300,
          },
        },
        categories: [
          ...subjectCodes,
          "REMEMBERING",
          "CREATING",
          "UNDERSTANDING",
          "APPLYING",
          "ANALYZING",
          "EVALUATING",
        ],
      },
      yaxis: {
        labels: {
          style: {
            colors: "#243642",
            fontSize: "12px",
            fontFamily: "inherit",
            fontWeight: 400,
          },
        },
      },
      grid: {
        show: true,
        borderColor: "#c9c7c7",
        strokeDashArray: 5,
        xaxis: {
          lines: {
            show: true,
          },
        },
        padding: {
          top: 20,
          right: 20,
        },
      },
      fill: {
        opacity: 0.8,
      },
      tooltip: {
        theme: "dark",
      },
    };
  
    const chart = new ApexCharts(document.querySelector("#bar-chart"), chartConfig);
    chart.render();
  });
  </script>
  </div>
{% endblock content %}